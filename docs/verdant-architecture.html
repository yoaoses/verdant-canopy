<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Verdant Canopy Â· Arquitectura</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Fraunces:ital,wght@0,300;0,600;0,900;1,300&family=DM+Sans:wght@300;400;500&display=swap');

  :root {
    --bg:#0e1208;--surface:#151a0e;--surface2:#1c2414;--border:#2a3520;
    --green:#7ec850;--green-dim:#1e2f10;--green-bright:#a8e070;
    --amber:#c8a040;--amber-dim:#2a2010;--teal:#50c8a8;--teal-dim:#0e2820;
    --red:#e05050;--red-dim:#2a1010;--blue:#5090e0;--blue-dim:#101828;
    --purple:#9070d0;--purple-dim:#181028;
    --text:#d8e8c8;--text-mid:#8a9e78;--text-dim:#4a5a3a;
  }

  *{margin:0;padding:0;box-sizing:border-box;}
  body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;line-height:1.7;}

  body::before{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");pointer-events:none;z-index:1000;opacity:0.4;}

  nav{position:sticky;top:0;z-index:100;background:rgba(14,18,8,0.92);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);padding:14px 40px;display:flex;align-items:center;justify-content:space-between;}
  .nav-brand{display:flex;align-items:baseline;gap:10px;}
  .nav-name{font-family:'Fraunces',serif;font-size:20px;font-weight:900;color:var(--green-bright);letter-spacing:-0.5px;}
  .nav-sub{font-family:'DM Mono',monospace;font-size:10px;color:var(--text-dim);letter-spacing:2px;text-transform:uppercase;}
  .nav-links{display:flex;gap:28px;list-style:none;}
  .nav-links a{font-family:'DM Mono',monospace;font-size:11px;color:var(--text-mid);text-decoration:none;letter-spacing:1px;text-transform:uppercase;transition:color 0.2s;}
  .nav-links a:hover,.nav-links a.active{color:var(--green);}

  .page{max-width:1000px;margin:0 auto;padding:56px 40px 100px;}

  .hero{margin-bottom:56px;}
  .hero-eyebrow{font-family:'DM Mono',monospace;font-size:10px;color:var(--green);letter-spacing:4px;text-transform:uppercase;margin-bottom:16px;display:flex;align-items:center;gap:10px;}
  .hero-eyebrow::before{content:'';display:inline-block;width:24px;height:1px;background:var(--green);}
  .hero h1{font-family:'Fraunces',serif;font-size:42px;font-weight:900;line-height:1.1;margin-bottom:12px;letter-spacing:-1px;}
  .hero h1 em{font-style:italic;color:var(--green-bright);}
  .hero p{color:var(--text-mid);font-size:15px;max-width:560px;}

  .section{margin-bottom:56px;}
  .section-header{display:flex;align-items:center;gap:14px;margin-bottom:24px;}
  .section-num{font-family:'DM Mono',monospace;font-size:10px;color:var(--text-dim);letter-spacing:3px;}
  .section-title{font-family:'Fraunces',serif;font-size:22px;font-weight:600;}
  .section-line{flex:1;height:1px;background:var(--border);}

  /* MAIN DIAGRAM */
  .diagram{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:36px;position:relative;overflow:hidden;}
  .diagram::before{content:'';position:absolute;inset:0;background-image:linear-gradient(rgba(126,200,80,0.02) 1px,transparent 1px),linear-gradient(90deg,rgba(126,200,80,0.02) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;}

  .diag-layer{margin-bottom:6px;}
  .diag-label{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:3px;text-transform:uppercase;margin-bottom:8px;display:flex;align-items:center;gap:8px;}
  .diag-label::after{content:'';flex:1;height:1px;background:var(--border);}

  .diag-nodes{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;}

  .diag-node{border:1px solid;border-radius:6px;padding:12px 16px;font-size:12px;text-align:center;min-width:110px;cursor:pointer;transition:all 0.2s;position:relative;}
  .diag-node:hover{transform:translateY(-3px);box-shadow:0 8px 24px rgba(0,0,0,0.4);}
  .diag-node .n-name{font-weight:500;font-size:13px;margin-bottom:2px;}
  .diag-node .n-sub{font-size:10px;opacity:0.65;font-family:'DM Mono',monospace;}

  .n-edge   {border-color:var(--teal);background:var(--teal-dim);color:var(--teal);}
  .n-hub    {border-color:var(--amber);background:var(--amber-dim);color:var(--amber);}
  .n-cloud  {border-color:var(--blue);background:var(--blue-dim);color:var(--blue);}
  .n-ui     {border-color:var(--purple);background:var(--purple-dim);color:var(--purple);}

  .diag-connector{display:flex;align-items:center;justify-content:center;gap:16px;margin:4px 0 8px;}
  .conn-line{flex:1;max-width:100px;height:1px;background:var(--border);}
  .conn-label{font-family:'DM Mono',monospace;font-size:9px;color:var(--text-dim);letter-spacing:1px;padding:2px 10px;border:1px solid var(--border);border-radius:20px;}

  /* DETAIL */
  .detail-panel{background:var(--surface2);border:1px solid var(--border);border-radius:6px;padding:16px 20px;margin-top:20px;display:none;animation:fadeIn 0.2s ease;}
  .detail-panel.visible{display:block;}
  @keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}
  .detail-title{font-family:'Fraunces',serif;font-size:16px;font-weight:600;margin-bottom:6px;}
  .detail-body{font-size:13px;color:var(--text-mid);line-height:1.8;}
  .detail-body strong{color:var(--text);}

  /* LEGEND */
  .legend{display:flex;gap:16px;flex-wrap:wrap;margin-top:20px;padding-top:16px;border-top:1px solid var(--border);}
  .legend-item{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--text-mid);}
  .legend-dot{width:10px;height:10px;border-radius:2px;border:1px solid;}

  /* FLOW */
  .flow{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:28px;}
  .flow-step{display:flex;gap:16px;margin-bottom:0;}
  .flow-left{display:flex;flex-direction:column;align-items:center;width:32px;flex-shrink:0;}
  .flow-num{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'DM Mono',monospace;font-size:10px;font-weight:500;border:1px solid var(--border);color:var(--text-mid);background:var(--surface2);z-index:1;}
  .flow-vline{flex:1;width:1px;background:var(--border);min-height:20px;margin-top:4px;}
  .flow-content{flex:1;padding-bottom:24px;}
  .flow-title{font-weight:600;font-size:14px;margin-bottom:3px;margin-top:4px;}
  .flow-desc{font-size:13px;color:var(--text-mid);}
  .flow-code{font-family:'DM Mono',monospace;font-size:11px;background:var(--surface2);border:1px solid var(--border);border-radius:4px;padding:8px 12px;margin-top:8px;color:var(--green);line-height:1.8;}

  /* MODES */
  .modes{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
  .mode-card{background:var(--surface);border:1px solid var(--border);border-radius:6px;padding:18px;}
  .mode-title{font-family:'Fraunces',serif;font-size:15px;font-weight:600;margin-bottom:4px;}
  .mode-sub{font-family:'DM Mono',monospace;font-size:9px;color:var(--text-dim);letter-spacing:2px;text-transform:uppercase;margin-bottom:12px;}
  .mode-steps{list-style:none;font-size:12px;color:var(--text-mid);}
  .mode-steps li{padding:4px 0;border-bottom:1px solid var(--border);display:flex;gap:8px;}
  .mode-steps li:last-child{border-bottom:none;}
  .mode-steps li::before{content:'â†’';color:var(--text-dim);}

  footer{border-top:1px solid var(--border);padding:24px 40px;text-align:center;font-family:'DM Mono',monospace;font-size:10px;color:var(--text-dim);letter-spacing:1px;}
  footer a{color:var(--green);text-decoration:none;}

  @media(max-width:600px){.page{padding:24px 20px 60px;}.nav-links{display:none;}.modes{grid-template-columns:1fr;}.hero h1{font-size:28px;}}
</style>
</head>
<body>

<nav>
  <div class="nav-brand">
    <span class="nav-name">Verdant Canopy</span>
    <span class="nav-sub">docs</span>
  </div>
  <ul class="nav-links">
    <li><a href="verdant-checkpoint.html">Checkpoint</a></li>
    <li><a href="#" class="active">Arquitectura</a></li>
    <li><a href="verdant-stack.html">Stack</a></li>
  </ul>
</nav>

<div class="page">

  <div class="hero">
    <div class="hero-eyebrow">DocumentaciÃ³n tÃ©cnica Â· v2.0</div>
    <h1>Arquitectura del <em>Sistema</em></h1>
    <p>Sistema hÃ­brido local/nube. Funciona sin internet. Se sincroniza cuando hay conexiÃ³n. Resiste fallos en cualquier capa.</p>
  </div>

  <!-- DIAGRAM -->
  <div class="section">
    <div class="section-header">
      <span class="section-num">01</span>
      <span class="section-title">Diagrama â€” click en cada nodo para detalles</span>
      <div class="section-line"></div>
    </div>

    <div class="diagram">

      <div class="diag-layer">
        <div class="diag-label" style="color:var(--teal)">â”€â”€ Capa 1 Â· Nodos edge</div>
        <div class="diag-nodes">
          <div class="diag-node n-edge" onclick="detail('picow')"><div class="n-name">Pico W #1</div><div class="n-sub">Ambiente + Canopy</div></div>
          <div class="diag-node n-edge" onclick="detail('picow2')"><div class="n-name">Pico W #2</div><div class="n-sub">Calidad agua riego</div></div>
          <div class="diag-node n-edge" onclick="detail('sensores')"><div class="n-name">Sensores</div><div class="n-sub">DS18B20 Â· BH1750 Â· RCWL Â· pH Â· TDS</div></div>
          <div class="diag-node n-edge" onclick="detail('relay')"><div class="n-name">Relay Ã—4</div><div class="n-sub">220V AC Â· Opto-acoplado</div></div>
        </div>
      </div>

      <div class="diag-connector">
        <div class="conn-line"></div>
        <div class="conn-label">WiFi local Â· MQTT</div>
        <div class="conn-line"></div>
      </div>

      <div class="diag-layer">
        <div class="diag-label" style="color:var(--amber)">â”€â”€ Capa 2 Â· Hub central (Pi 4B)</div>
        <div class="diag-nodes">
          <div class="diag-node n-hub" onclick="detail('mosquitto')"><div class="n-name">Mosquitto</div><div class="n-sub">MQTT Broker local</div></div>
          <div class="diag-node n-hub" onclick="detail('fastapi')"><div class="n-name">FastAPI</div><div class="n-sub">API local Â· REST</div></div>
          <div class="diag-node n-hub" onclick="detail('sqlite')"><div class="n-name">SQLite</div><div class="n-sub">Buffer Â· Config Â· Logs</div></div>
          <div class="diag-node n-hub" onclick="detail('sync')"><div class="n-name">Sync Service</div><div class="n-sub">Python Â· Batch â†’ Firebase</div></div>
          <div class="diag-node n-hub" onclick="detail('hotspot')"><div class="n-name">WiFi Hotspot</div><div class="n-sub">Red local propia</div></div>
        </div>
      </div>

      <div class="diag-connector">
        <div class="conn-line"></div>
        <div class="conn-label">HTTPS Â· cuando hay internet</div>
        <div class="conn-line"></div>
      </div>

      <div class="diag-layer">
        <div class="diag-label" style="color:var(--blue)">â”€â”€ Capa 3 Â· Firebase (nube)</div>
        <div class="diag-nodes">
          <div class="diag-node n-cloud" onclick="detail('firestore')"><div class="n-name">Firestore</div><div class="n-sub">Tiempo real Â· HistÃ³rico</div></div>
          <div class="diag-node n-cloud" onclick="detail('fbauth')"><div class="n-name">Firebase Auth</div><div class="n-sub">RBAC Â· custom claims</div></div>
          <div class="diag-node n-cloud" onclick="detail('functions')"><div class="n-name">Cloud Functions</div><div class="n-sub">Node.js Â· Alertas</div></div>
          <div class="diag-node n-cloud" onclick="detail('hosting')"><div class="n-name">Hosting</div><div class="n-sub">React Â· HTTPS Â· CDN</div></div>
          <div class="diag-node n-cloud" onclick="detail('fcm')"><div class="n-name">FCM</div><div class="n-sub">Push notifications</div></div>
        </div>
      </div>

      <div class="diag-connector">
        <div class="conn-line"></div>
        <div class="conn-label">Browser Â· PWA</div>
        <div class="conn-line"></div>
      </div>

      <div class="diag-layer">
        <div class="diag-label" style="color:var(--purple)">â”€â”€ Capa 4 Â· Interfaces</div>
        <div class="diag-nodes">
          <div class="diag-node n-ui" onclick="detail('tablet')"><div class="n-name">Tablet Kiosk</div><div class="n-sub">Panel control Â· Local</div></div>
          <div class="diag-node n-ui" onclick="detail('pwa')"><div class="n-name">PWA</div><div class="n-sub">Dashboard Â· Kiosk</div></div>
          <div class="diag-node n-ui" onclick="detail('react')"><div class="n-name">React Dashboard</div><div class="n-sub">Admin Â· Firebase Hosting</div></div>
        </div>
      </div>

      <div class="detail-panel" id="detail-panel">
        <div class="detail-title" id="detail-title"></div>
        <div class="detail-body" id="detail-body"></div>
      </div>

      <div class="legend">
        <div class="legend-item"><div class="legend-dot" style="border-color:var(--teal);background:var(--teal-dim)"></div>Nodos edge</div>
        <div class="legend-item"><div class="legend-dot" style="border-color:var(--amber);background:var(--amber-dim)"></div>Hub local Pi 4B</div>
        <div class="legend-item"><div class="legend-dot" style="border-color:var(--blue);background:var(--blue-dim)"></div>Firebase nube</div>
        <div class="legend-item"><div class="legend-dot" style="border-color:var(--purple);background:var(--purple-dim)"></div>Interfaces usuario</div>
      </div>
    </div>
  </div>

  <!-- FLUJO DE DATOS -->
  <div class="section">
    <div class="section-header">
      <span class="section-num">02</span>
      <span class="section-title">Flujo de datos â€” sensor a pantalla</span>
      <div class="section-line"></div>
    </div>

    <div class="flow">
      <div class="flow-step">
        <div class="flow-left"><div class="flow-num">1</div><div class="flow-vline"></div></div>
        <div class="flow-content">
          <div class="flow-title" style="color:var(--teal)">Pico W #1 lee sensores ambiente cada 30s</div>
          <div class="flow-desc">DS18B20, BH1750, RCWL-1601Ã—4. EvalÃºa reglas failsafe localmente. Si supera umbral crÃ­tico activa relay inmediato sin esperar a nadie.</div>
          <div class="flow-code">sensor â†’ { temp:24.2, lux:18000, canopy_h:45, ts:... }</div>
        </div>
      </div>
      <div class="flow-step">
        <div class="flow-left"><div class="flow-num">2</div><div class="flow-vline"></div></div>
        <div class="flow-content">
          <div class="flow-title" style="color:var(--teal)">Pico W publica vÃ­a MQTT</div>
          <div class="flow-desc">Serializa a JSON y publica en Mosquitto. La Pi suscribe al topic y recibe el dato.</div>
          <div class="flow-code">topic: verdant/zone1/sensors<br>payload: {"temp":24.2,"hum":62,...}</div>
        </div>
      </div>
      <div class="flow-step">
        <div class="flow-left"><div class="flow-num">3</div><div class="flow-vline"></div></div>
        <div class="flow-content">
          <div class="flow-title" style="color:var(--amber)">Pi guarda en SQLite (buffer)</div>
          <div class="flow-desc">Persiste el dato localmente. La tablet y la PWA en red local pueden leerlo vÃ­a FastAPI inmediatamente.</div>
          <div class="flow-code">sqlite â†’ readings(zone, sensors_json, ts, synced=False)</div>
        </div>
      </div>
      <div class="flow-step">
        <div class="flow-left"><div class="flow-num">4</div><div class="flow-vline"></div></div>
        <div class="flow-content">
          <div class="flow-title" style="color:var(--amber)">Sync service sube batch cada 5 min</div>
          <div class="flow-desc">Si hay internet: agrega las Ãºltimas lecturas y sube en lote a Firestore. Marca como sincronizado. Si no hay internet: guarda, reintenta despuÃ©s.</div>
          <div class="flow-code">if internet: firebase.batch_write(pending) â†’ mark synced<br>else: keep pending â†’ retry on reconnect</div>
        </div>
      </div>
      <div class="flow-step">
        <div class="flow-left"><div class="flow-num">5</div><div class="flow-vline"></div></div>
        <div class="flow-content">
          <div class="flow-title" style="color:var(--blue)">Cloud Function evalÃºa alertas</div>
          <div class="flow-desc">Al escribir en Firestore se dispara una Function que evalÃºa si el valor supera umbrales configurados. Si sÃ­, llama a FCM.</div>
          <div class="flow-code">onWrite(sensors) â†’ if temp > threshold â†’ fcm.send(users)</div>
        </div>
      </div>
      <div class="flow-step">
        <div class="flow-left"><div class="flow-num" style="background:var(--green-dim);border-color:var(--green);color:var(--green)">6</div></div>
        <div class="flow-content">
          <div class="flow-title" style="color:var(--green)">Push llega al celular</div>
          <div class="flow-desc">FCM entrega notificaciÃ³n push web. El React dashboard se actualiza en tiempo real vÃ­a Firestore listeners. La tablet lo ve por FastAPI local.</div>
          <div class="flow-code">FCM â†’ "âš ï¸ Temperatura alta: 31Â°C en Zona 1"</div>
        </div>
      </div>
    </div>
  </div>

  <!-- MODOS DE OPERACIÃ“N -->
  <div class="section">
    <div class="section-header">
      <span class="section-num">03</span>
      <span class="section-title">Modos de operaciÃ³n</span>
      <div class="section-line"></div>
    </div>

    <div class="modes">
      <div class="mode-card">
        <div class="mode-title">ğŸŸ¢ Modo normal</div>
        <div class="mode-sub">Todo funcionando Â· con internet</div>
        <ul class="mode-steps">
          <li>Pico W #1 lee sensores ambiente y publica cada 30s</li>
          <li>Pico W #2 mide calidad agua cuando el usuario lo usa</li>
          <li>Pi agrega y sube a Firebase cada 5min</li>
          <li>Tablet ve datos en tiempo real local</li>
          <li>La PWA ve datos desde Firebase</li>
          <li>Alertas llegan por FCM</li>
          <li>Dashboard web actualizado</li>
        </ul>
      </div>
      <div class="mode-card">
        <div class="mode-title">ğŸŸ¡ Sin internet</div>
        <div class="mode-sub">Red local ok Â· Firebase no disponible</div>
        <ul class="mode-steps">
          <li>Pico W sigue leyendo y publicando</li>
          <li>Pi guarda en SQLite (buffer)</li>
          <li>Tablet funciona normal (local)</li>
          <li>La PWA funciona normal (local)</li>
          <li>Push notifications no llegan (sin internet)</li>
          <li>Al volver la red: sube batch acumulado</li>
        </ul>
      </div>
      <div class="mode-card">
        <div class="mode-title">ğŸ”´ Pi caÃ­da</div>
        <div class="mode-sub">Hub offline Â· nodos solos</div>
        <ul class="mode-steps">
          <li>Pico W #1 detecta Pi ausente > 5min</li>
          <li>Activa modo autÃ³nomo completo</li>
          <li>Ejecuta reglas failsafe locales</li>
          <li>RelÃ©s responden a sensores directamente</li>
          <li>Cultivo protegido sin servidor</li>
          <li>Al volver la Pi: resync automÃ¡tico</li>
        </ul>
      </div>
      <div class="mode-card">
        <div class="mode-title">ğŸ”µ Solo nube</div>
        <div class="mode-sub">Acceso remoto Â· fuera de casa</div>
        <ul class="mode-steps">
          <li>La PWA lee Firebase</li>
          <li>Dashboard web lee Firebase</li>
          <li>Comandos relay van a Firebase</li>
          <li>Pi los ejecuta al recibirlos</li>
          <li>Historial completo disponible</li>
          <li>Alertas funcionan normalmente</li>
        </ul>
      </div>
    </div>
  </div>

</div>

<footer>
  <p>Verdant Canopy Â· Arquitectura v2.0 Â· <a href="verdant-checkpoint.html">Checkpoint</a> Â· <a href="verdant-stack.html">Stack</a></p>
</footer>

<script>
const details = {
  picow:{title:'ğŸ“¡ Raspberry Pi Pico W #1 â€” Ambiente + Canopy',body:'<strong>Firmware:</strong> MicroPython Â· <strong>Conectividad:</strong> WiFi 2.4GHz integrado<br>Lee sensores ambiente (DS18B20, BH1750, RCWL-1601Ã—4) â†’ evalÃºa failsafe â†’ publica MQTT â†’ controla relay luz y extractor.<br><strong>Clave:</strong> opera completamente solo si la Pi 4B cae. Guarda umbrales en flash â€” persisten sin red.'},
  picow2:{title:'ğŸ“¡ Raspberry Pi Pico W #2 â€” Calidad agua de riego',body:'<strong>Firmware:</strong> MicroPython Â· <strong>FunciÃ³n:</strong> medidor de calidad de agua portÃ¡til<br>Lee PT100, sonda pH, TDS Metro â†’ muestra resultado en display pequeÃ±o.<br><strong>UX:</strong> semÃ¡foro simple âœ… agua lista / âš ï¸ ajustar pH / âŒ no regar. El riego sigue siendo manual.'},
  esp:{title:'ğŸ“» ESP8266 / NodeMCU â€” Nodo sensor simple',body:'<strong>Firmware:</strong> MicroPython o Arduino Â· <strong>Rol:</strong> solo leer y publicar.<br>Ideal para sensores adicionales en zonas secundarias donde no se necesita control de actuadores. Sin lÃ³gica de failsafe.'},
  sensores:{title:'ğŸŒ¡ï¸ Sensores disponibles',body:'<strong>DS18B20:</strong> sonda one-wire, temperatura ambiente y agua, Â±0.5Â°C<br><strong>PT100 + intÃ©rprete:</strong> temperatura precisiÃ³n industrial Â±0.1Â°C, agua de riego<br><strong>RCWL-1601 Ã—4:</strong> ultrasonido, mapa canopy por interpolaciÃ³n bilinear, lectura cada 6 horas<br><strong>BH1750:</strong> luz en lux, calcula DLI acumulado diario<br><strong>Sonda pH + intÃ©rprete:</strong> pH agua de riego, rango Ã³ptimo por cultivo<br><strong>TDS Metro:</strong> sales disueltas ppm, calidad agua de riego<br><strong>FlujÃ³metro:</strong> reservado para Beta 2 (riego automÃ¡tico)<br><strong>Relay Ã—4:</strong> Ã—2 por Pico W, luz + extractor (+ bomba + recirculador)'},
  relay:{title:'âš¡ Relay 4 canales 5V â€” Control AC',body:'<strong>Voltaje control:</strong> 5V del Pico W Â· <strong>Carga:</strong> 220V AC / 10A por canal<br><strong>Canales:</strong> Ã—2 por Pico W Â· Pico W #1: Luz + Extractor Â· Pico W #2: bomba + recirculador (reservado)<br><strong>Seguridad:</strong> Opto-acoplado â€” aisla Pico W del circuito de 220V.'},
  mosquitto:{title:'ğŸ“¨ Mosquitto â€” MQTT Broker',body:'<strong>Puerto:</strong> 1883 local Â· <strong>RAM:</strong> ~10MB<br>Intermediario entre nodos (publican) y FastAPI (suscribe). Desacopla hardware de software.<br><strong>Topics:</strong> verdant/zoneN/sensors Â· verdant/zoneN/relay/cmd Â· verdant/zoneN/relay/state'},
  fastapi:{title:'âš¡ FastAPI â€” API local',body:'<strong>Puerto:</strong> 8000 Â· accesible desde tablet y PWA en red local<br>Expone datos de sensores y control de relÃ©s. Funciona sin internet.<br><strong>Endpoints:</strong> /sensors Â· /relay Â· /status Â· /zones'},
  sqlite:{title:'ğŸ“„ SQLite â€” Buffer local',body:'<strong>RAM:</strong> ~1MB Â· incluido en Python<br>Guarda todas las lecturas con flag <code>synced</code>. El sync service las sube a Firebase y las marca. Config del sistema, logs de eventos, perfiles de cultivo.'},
  sync:{title:'ğŸ”„ Sync Service â€” Pi â†’ Firebase',body:'Servicio Python que corre en la Pi. Cada 5 minutos: lee pendientes en SQLite â†’ sube batch a Firestore â†’ marca como sincronizados.<br>Alertas crÃ­ticas van inmediatas sin esperar el batch.<br>Maneja reconexiÃ³n automÃ¡tica.'},
  hotspot:{title:'ğŸ“¶ WiFi Hotspot â€” Red local propia',body:'La Pi 4B emite su propia red WiFi. Pico W, ESPs y tablet se conectan a ella.<br><strong>Ventaja clave:</strong> completamente independiente del router del ISP. Telsur puede caerse â€” el sistema local sigue funcionando.<br>Configurado con hostapd + dnsmasq.'},
  firestore:{title:'ğŸ”¥ Firestore â€” Base de datos en tiempo real',body:'<strong>Plan Spark (gratis):</strong> 1GB almacenamiento Â· 50k lecturas/dÃ­a Â· 20k escrituras/dÃ­a<br>Para sensores cada 5min: 288 escrituras/dÃ­a por zona âœ…<br>Listeners en tiempo real para React y PWA â€” los datos llegan sin polling.'},
  fbauth:{title:'ğŸ” Firebase Auth â€” AutenticaciÃ³n',body:'Reemplaza JWT propio. <strong>Custom claims</strong> para RBAC (rol: admin/cuidador/observador).<br>El Admin crea cuentas â€” la abuela nunca ve pantalla de registro.<br>10k usuarios/mes gratis.'},
  functions:{title:'âš™ï¸ Cloud Functions â€” LÃ³gica serverless',body:'<strong>Lenguaje:</strong> Node.js Â· <strong>Plan gratis:</strong> 2M invocaciones/mes<br>Se dispara al escribir en Firestore. EvalÃºa si el valor supera umbrales â†’ llama a FCM.<br>Sin servidor que mantener â€” escala sola.'},
  hosting:{title:'ğŸŒ Firebase Hosting â€” React dashboard',body:'Sirve el build de React con HTTPS automÃ¡tico y CDN global.<br><strong>Plan gratis:</strong> 10GB transferencia/mes<br>Deploy: <code>firebase deploy --only hosting</code>'},
  fcm:{title:'ğŸ”” FCM â€” Push notifications',body:'Notificaciones push web via FCM. Sin apps extra para el usuario.<br>Alertas crÃ­ticas llegan siempre a Observadores â€” incluso con telÃ©fono en silencio.<br><strong>Costo:</strong> gratis ilimitado.'},
  tablet:{title:'ğŸ“Ÿ Tablet Android â€” Panel kiosk',body:'Conectada al WiFi de la Pi Â· lee FastAPI local Â· sin internet necesario.<br>Control manual de relÃ©s, estado tiempo real, override de automatizaciÃ³n.<br><strong>Kiosk:</strong> pantalla siempre encendida, gesto secreto para salir, sin acceso a otras apps.'},
  pwa:{title:'ğŸ“± PWA â€” Progressive Web App',body:'<strong>En casa (WiFi Pi):</strong> habla con FastAPI local directamente<br><strong>Fuera de casa:</strong> lee Firebase en tiempo real<br>Funciona offline con Service Workers. DetecciÃ³n automÃ¡tica de red. SemÃ¡foro visual â€” sin nÃºmeros que interpretar.'},
  react:{title:'âš›ï¸ React Dashboard â€” Admin web',body:'Hosteado en Firebase Hosting. Lee Firestore con listeners en tiempo real.<br><strong>Funciones:</strong> histÃ³rico con grÃ¡ficos Â· configuraciÃ³n de umbrales Â· gestiÃ³n de usuarios Â· registro de ciclos Â· comparativa de producciÃ³n.'}
};

function detail(key) {
  const d = details[key];
  if (!d) return;
  document.getElementById('detail-title').textContent = d.title;
  document.getElementById('detail-body').innerHTML = d.body;
  const panel = document.getElementById('detail-panel');
  panel.classList.add('visible');
  panel.scrollIntoView({behavior:'smooth',block:'nearest'});
}
</script>
</body>
</html>
